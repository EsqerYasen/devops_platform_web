{% extends 'common/basic_rank_list.html' %}
{% load widget_tweaks %}

{% block list_title %}
    未分配主机
{% endblock %}

{% block  group_count %}
    <div class="col-sm-8">
        {% if user.is_superuser %}
            <a href="../add/" class="btn btn-sm btn-info" style="margin-right: 10px">全部：300</a>
            <a href="../add/" class="btn btn-sm btn-info" style="margin-right: 10px">EC：100</a>
            <a href="../add/" class="btn btn-sm btn-info" style="margin-right: 10px">Brand：100</a>
            <a href="../add/" class="btn btn-sm btn-info" style="margin-right: 10px">Store：100</a>
        {% endif %}
    </div>
{% endblock %}

{% block  list_search %}
    <div class="col-sm-1" style="width: 12%">
        <input type="text" id="host_ip_search" name="host_ip" class="form-control" placeholder="请输入IP">
    </div>
    <div class="col-sm-1" style="width: 11%">
        <select id="physical_idc_search" name="physical_idc" class="form-control">
            <option value="" selected>机房</option>
            {% for o in pidc_list %}
                <option value="{{ o.id }}" >{{ o.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-sm-1" style="width: 11%">
        <select id="logical_idc_search" name="logical_idc" class="form-control">
            <option value="" selected>区域</option>
            {% for o in lidc_list %}
                <option value="{{ o.id }}" >{{ o.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-sm-1" style="width: 11%">
        <select id="biz_brand_search" name="biz_brand" class="form-control" onchange="brandChange(this,'biz_group_search')">
            <option value="" selected>品牌</option>
            {% for o in brand_list %}
                <option value="{{ o.id }}" >{{ o.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-sm-1" style="width: 12%">
        <select id="biz_group_search" name="biz_group" class="form-control">
            <option value="" selected>业务线</option>
        </select>
    </div>
{% endblock %}

{% block list_filter %}
    <div class="col-sm-5">
        <div class="input-group">
            <button type="submit" class="btn btn-sm btn-primary" style="margin-right: 10px"><i class="fa fa-search"></i> 搜索</button>
            <button type="button" class="btn btn-sm btn-success" data-toggle='modal' data-target='#advanced_query_modal' style="margin-right: 10px"><i class="glyphicon glyphicon-search"></i> 高级查询</button>
            <button type="button" class="btn btn-sm btn-success" data-toggle='modal' data-target='#to_not_online_modal' style="margin-right: 10px"><i class="glyphicon glyphicon-log-in"></i> 待上线</button>
            <button type="button" class="btn btn-sm btn-success" data-toggle='modal' data-target='#edit_modal' style="margin-right: 10px"><i class="glyphicon glyphicon-edit"></i> 修改</button>
            <button type="button" class="btn btn-sm btn-success" data-toggle='modal' data-target='#import_host_modal' style="margin-right: 10px"><i class="glyphicon glyphicon-import"></i> 导入</button>
            <button type="button" class="btn btn-sm btn-success" data-toggle='modal' data-target='#export_host_modal' style="margin-right: 10px"><i class="glyphicon glyphicon-export"></i> 导出</button>
            <button type="button" class="btn btn-sm btn-success" title="删除" onclick="deleteBatch()"><i class="glyphicon glyphicon-trash"></i> 删除</button>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            initAdvancedQueryModal();
            initToOnlineModal();
            importHostFile();
        });
        function initAdvancedQueryModal(){
            $("#advanced_query_modal").on('show.bs.modal',function(event){

            });
        }
        function initToOnlineModal(){
            $("#to_not_online_modal").on('show.bs.modal',function(event){
                var biz_service_2 = $("#biz_service_2");
                biz_service_2.chosen();

                var middleware_2 = $("#middleware_2");
                middleware_2.chosen();

                var dns_2 = $("#dns_2");
                dns_2.chosen();
            });
        }
        function importHostFile(){
            $("#import_host_file").fileinput({
                showPreview: false,
                showUpload: false,
                elErrorContainer: '#kartik-file-errors',
                allowedFileExtensions: ['xls', 'xlsx'],
                maxFilesNum:1,
                language:'zh'
            });
        }

        function brandChange(sel,g_id){
            $.ajax({
                type: "GET",
                url: '/cmdb/business/get_groups_by_brandId/',
                async:false,
                data:{"brand_id":$(sel).val()},
                error: function (request) {},
                success: function (data) {
                    var select_obj = $("#"+g_id);
                    select_obj.empty();
                     select_obj.append("<option value=''>请选择业务线</option>");
                    $(data).each(function(index,item){
                         select_obj.append("<option value='"+item.id+"' keycode='"+item.key_code+"'>"+item.name+"</option>");
                    })
                }
            })
        }

        function groupChange(sel,b_id,m_id){
            $.ajax({
                type: "GET",
                url: '/cmdb/business/get_module_by_bIdgId/',
                async:false,
                data:{"brand_id":$("#"+b_id).val(),'group_id':$(sel).val()},
                error: function (request) {},
                success: function (data) {
                    var select_obj = $("#"+m_id);
                    select_obj.empty();
                     select_obj.append("<option value=''>请选择模块</option>");
                    $(data).each(function(index,item){
                         select_obj.append("<option value='"+item.id+"' keycode='"+item.key_code+"'>"+item.name+"</option>");
                    })
                }
            })
        }

        function moduleChange(sel,b_id,g_id,s_id){
            $.ajax({
                type: "GET",
                url: '/cmdb/business/get_service_by_bIdgIdMid/',
                async:false,
                data:{"brand_id":$("#"+b_id).val(),'group_id':$("#"+g_id).val(),'biz_module':$(sel).val()},
                error: function (request) {},
                success: function (data) {
                    var select_obj = $("#"+s_id);
                    select_obj.empty();
                    $(data).each(function(index,item){
                         select_obj.append("<option value='"+item.id+"' keycode='"+item.key_code+"'>"+item.name+"</option>");
                    })
                    select_obj.trigger("liszt:updated");
                }
            })
        }

    </script>
{% endblock %}

{% block list_content %}
    <script type="text/javascript" src="/static/hplus/js/chosen/chosen.jquery.js"></script>
    <script type="text/javascript" src="/static/hplus/js/fileinput.min.js"></script>
    <script type="text/javascript" src="/static/hplus/js/fileinput.zh.js"></script>
    <link href="/static/hplus/css/chosen/chosen.css" rel="stylesheet">
    <link href="/static/hplus/css/fileinput.min.css" rel="stylesheet">

    <div class="ibox " style="display: none;" id="loading_div">
        <div class="spiner-example">
            <div class="sk-spinner sk-spinner-three-bounce">
                <div class="sk-bounce1"></div>
                <div class="sk-bounce2"></div>
                <div class="sk-bounce3"></div>
            </div>
        </div>
    </div>
    <table id="tb" class="table table-striped table-bordered table-hover dataTables-example dataTable">
        <thead>
            <tr>
                <th style="width:3%;"><input id="checkall" type="checkbox" class="i-checks"></th>
                <th style="width: 8%;">
                    Owner
                </th>
                <th style="width: 8%;">
                    机房
                </th>
                <th style="width: 8%;">
                    区域
                </th>
                <th style="width: 8%;">
                    IP
                </th>
                <th style="width: 11%;">
                    品牌
                </th>
                <th style="width: 6%;">
                    业务线
                </th>
                <th style="width:8%;">操作</th>
            </tr>
        </thead>
        <tbody>
        {% for o in result_list %}
            <tr>
                <td>
                    <input type="checkbox" class="i-checks icheck" id="{{ o.id }}" hostip="{{ o.host_ip }}" name="trCheckbox">
                </td>
                <td>{{ o.owner }}</td>
                <td>{{ o.physical_idc_name }}</td>
                <td>{{ o.logical_idc_name }}</td>
                <td>{{ o.host_ip }}</td>
                <td>{{ o.biz_brand_name }}</td>
                <td>{{ o.biz_group_name }}</td>
                <td>
                    <a href="../{{ o.id }}/detail1/" class="btn btn-sm btn-success"><i class="fa fa-book"></i> 查看</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endblock %}


{% block modal_div %}

    <div class="modal fade" id="advanced_query_modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">高级查询</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 500px;overflow:auto">
                    <form id="advanced_query_form" method="get">
                        <div class="row" style="margin-bottom: 10px">
                            <label class="col-sm-1 control-label">品牌</label>
                            <div class="col-sm-3">
                                <select id="biz_brand_1" name="biz_brand" class="form-control" onchange="brandChange(this,'biz_group_1')">
                                    <option value="" selected>请选择品牌</option>
                                    {% for o in brand_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">业务线</label>
                            <div class="col-sm-3">
                                <select id="biz_group_1" name="biz_group" class="form-control">
                                    <option value="" selected>请选择业务线</option>
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">机房</label>
                            <div class="col-sm-3">
                                <select id="physical_idc_1" name="physical_idc" class="form-control" style="width: 100%">
                                    <option value="" selected>请选择机房</option>
                                    {% for o in pidc_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-bottom: 10px">
                            <label class="col-sm-1 control-label">区域</label>
                            <div class="col-sm-3">
                                <select id="logical_idc_1" name="logical_idc" class="form-control">
                                    <option value="" selected>请选择区域</option>
                                    {% for o in lidc_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">CPU核数</label>
                            <div class="col-sm-3">
                                <input id="num_cpus_1" name="num_cpus" type="number" class="form-control" min="1" max="100"/>
                            </div>
                            <label class="col-sm-1 control-label">内存(MB)</label>
                            <div class="col-sm-3">
                                <input id="mem_total_1" name="mem_total" type="number" class="form-control" min="1" max="10000"/>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-1 control-label">操作系统</label>
                            <div class="col-sm-3">
                                <input id="os_1" name="os" type="text" class="form-control"/>
                            </div>
                            <label class="col-sm-1 control-label">系统类型</label>
                            <div class="col-sm-3">
                                <input id="os_family_1" name="os_family" type="text" class="form-control"/>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" title="确定" onclick="advancedQueryFun()">确定</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="to_not_online_modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">待上线分配</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 500px;overflow:auto">
                    <form id="to_not_online_form" method="get">
                        <div class="row" style="margin-bottom: 10px">
                            <label class="col-sm-1 control-label">品牌</label>
                            <div class="col-sm-3">
                                <select id="biz_brand_2" name="biz_brand" class="form-control" onchange="brandChange(this,'biz_group_2')">
                                    <option value="" selected>请选择品牌</option>
                                    {% for o in brand_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">业务线</label>
                            <div class="col-sm-3">
                                <select id="biz_group_2" name="biz_group" class="form-control" onchange="groupChange(this,'biz_brand_2','biz_module_2')">
                                    <option value="" selected>请选择业务线</option>
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">机房</label>
                            <div class="col-sm-3">
                                <select id="physical_idc_2" name="physical_idc" class="form-control">
                                    <option value="" selected>请选择机房</option>
                                    {% for o in pidc_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-bottom: 10px">
                            <label class="col-sm-1 control-label">模块</label>
                            <div class="col-sm-3">
                                <select id="biz_module_2" name="biz_module" class="form-control" onchange="moduleChange(this,'biz_brand_2','biz_group_2','biz_service_2')">
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">应用</label>
                            <div class="col-sm-3">
                                <select id="biz_service_2" name="biz_service" data-placeholder="请选择应用" class="chosen-select form-control" style="width:213px"  multiple tabindex="1">
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">区域</label>
                            <div class="col-sm-3">
                                <select id="logical_idc_2" name="logical_idc" class="form-control">
                                    <option value="" selected>请选择区域</option>
                                    {% for o in lidc_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-bottom: 10px">
                            <label class="col-sm-1 control-label">中间件</label>
                            <div class="col-sm-3">
                                <select id="middleware_2" name="middleware" data-placeholder="请选择中间件" class="chosen-select form-control" style="width:213px"  multiple tabindex="1">
                                    {% for o in mw_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">域名</label>
                            <div class="col-sm-3">
                                <select id="dns_2" name="dns" data-placeholder="请选择域名" class="chosen-select form-control" style="width:213px"  multiple tabindex="1">
                                    {% for o in dns_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-1 control-label">环境</label>
                            <div class="col-sm-3">
                                <select id="deployment_environment_2" name="deployment_environment" class="form-control" style="width: 100%">
                                    <option value="" selected>环境</option>
                                    {% for o in env_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-1 control-label">标签</label>
                            <div class="col-sm-11">
                                <textarea id="tag_2" name="tag"  class="form-control" style="height: 55px;resize:none;"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" title="Your custom upload logic" onclick="toNotOnline()">确定</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit_modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="width: 600px">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">修改</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 500px;overflow:auto">
                    <form id="to_online_form" method="get">
                        <div class="row" style="margin-bottom: 10px">
                            <label class="col-sm-2 control-label" style="width: 13%">品牌</label>
                            <div class="col-sm-4">
                                <select id="biz_brand_3" name="biz_brand" class="form-control" onchange="brandChange(this,'biz_group_3')">
                                    <option value="" selected>请选择品牌</option>
                                    {% for o in brand_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-2 control-label" style="width: 13%">业务线</label>
                            <div class="col-sm-4">
                                <select id="biz_group_3" name="biz_group" class="form-control">
                                    <option value="" selected>请选择业务线</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label" style="width: 13%">机房</label>
                            <div class="col-sm-4">
                                <select id="physical_idc_3" name="physical_idc" class="form-control" style="width: 100%">
                                    <option value="" selected>请选择机房</option>
                                    {% for o in pidc_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="col-sm-2 control-label" style="width: 13%">区域</label>
                            <div class="col-sm-4">
                                <select id="logical_idc_3" name="logical_idc" class="form-control">
                                    <option value="" selected>请选择区域</option>
                                    {% for o in lidc_list %}
                                        <option value="{{ o.id }}" >{{ o.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" title="确定更新" onclick="editHost()">确定</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="import_host_modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="width: 600px">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">导入</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 500px;overflow:auto">
                    <div class="col-sm-12">
                        <input id="import_host_file" type="file">
                    </div>
                    <div class="col-sm-5" style="margin-top: 20px;">
                        <a href="/cmdb/host/templateDownload/" class="link-popover" style="font-size: large">下载导入模板</a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" title="确定导入" onclick="importHostInfo()">确定</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="export_host_modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-lg" role="document" style="width: 400px">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">导出</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 500px;overflow:auto">
                    <div class="row">
                        <div class="col-sm-10" style="width: 100%;">
                            导出说明：导出数据是您当前搜索的所有数据
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-10" style="width: 100%;">
                            导出条数：{{ paginator.count }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" title="Your custom upload logic" onclick="exportHostInfo()">确定</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function advancedQueryFun(){
            var param = "";
            $($("#advanced_query_form").serializeArray()).each(function(index,item){
                if(item.value){
                    if(index > 0){
                         param += "&";
                    }
                    param += item.name+"="+item.value;
                }
            })
            if(param.length){
                $(location).attr('href', '/cmdb/host/list1/?'+param);
            }
        }

        function importHostInfo(){
            var formData = new FormData();
            formData.append("csrfmiddlewaretoken",'{{ csrf_token }}')
            formData.append('files',$("#import_host_file")[0].files[0]);
            $.ajax({
                url: '/cmdb/host/import/',
                type: 'POST',
                processData: false,
                contentType: false,
                data:formData,
                beforeSend:function(){
                    //Alertwin.alert({ message:"正在进行，请稍候"});
                },
                success:function(responseStr) {
                    if(responseStr.status===0){
                        Alertwin.alert({message:"正在进行，请稍候"});
                        $("#import_host_modal").modal('hide');
                        location.reload();
                    }else{
                        Alertwin.alert({message:"失败"});
                    }
                },
                error:function(responseStr) {
                    console.log(responseStr);
                }
            });
        }

        function exportHostInfo(){
            var param = getHostIdsOrSearch();
            if($("#tb tr").length > 1){
                if(param.length == 0){
                    Alertwin.alert({message:"请选择机器或条件查询"});
                    return;
                }else{
                    layer.load();
                    window.location.href = '/cmdb/host/export1/?' + param;
                    layer.closeAll('loading');
                }
            }else{
                Alertwin.alert({message:"查询结果为空"});
            }

        }

        function getHostIdsOrSearch(){
            var result = "";
            var ids = getChecked();
            if(!ids){
                var searchStr = location.search;
                searchStr = searchStr.substring(1,searchStr.length);
                var list = searchStr.split('&');
                $(list).each(function(i,item){
                    if(item.indexOf('offset')<0 || item.indexOf('limit')<0){
                        var s = item.split('=');
                        if(s[1]){
                            result+=s[0]+"="+s[1]+"&";
                        }
                    }
                });
                if(result.length>0){
                    result = "flag=2&"+result.substring(0,result.length-1)
                }
            }else{
                result="flag=1&id_list="+ids.substring(0,ids.length-1);
            }
            return result;
        }

        function getHostIPOrSearch(){
            var result = {};
            var ids = getCheckedHostIP();
            if(!ids){
                var searchStr = location.search;
                searchStr = searchStr.substring(1,searchStr.length);
                var list = searchStr.split('&');
                var dict = {};
                $(list).each(function(i,item){
                    if(item.indexOf('offset')<0 || item.indexOf('limit')<0){
                        var s = item.split('=');
                        if(s[1]){
                            dict[s[0]]=s[1];
                        }
                    }
                });
                if(!$.isEmptyObject(dict)){
                    result['flag'] = 2;
                    result['seach'] = JSON.stringify(dict);
                }
            }else{
                result['flag'] = 1;
                result['ip_list'] = JSON.stringify(ids.substring(0,ids.length-1).split(','));
            }
            return result;
        }

        function getCheckedHostIP() {
            var str = document.getElementsByName("trCheckbox");
            var objarray = str.length;
            var chestr = "";
            for (i = 0; i < objarray; i++) {
                if (str[i].checked == true) {
                    chestr += $(str[i]).attr('hostip') + ",";
                }
            }
            return chestr;
        }

        function editHost(){
            var param = getHostIPOrSearch();
            if($("#tb tr").length > 1) {
                if ($.isEmptyObject(param)) {
                    Alertwin.alert({message: "请选择机器或条件查询"});
                    return;
                } else {
                    var edit = {}
                    var biz_brand_3 = $("#biz_brand_3").val();
                    if(biz_brand_3){
                        edit['biz_brand'] = biz_brand_3;
                    }else{
                        Alertwin.alert({message: "品牌不能为空"});
                        return;
                    }
                    var biz_group_3 = $("#biz_group_3").val();
                    if(biz_group_3){
                        edit['biz_group'] = biz_group_3;
                    }else{
                        Alertwin.alert({message: "业务线不能为空"});
                        return;
                    }
                    var physical_idc_3 = $("#physical_idc_3").val();
                    if(physical_idc_3){
                        edit['physical_idc'] = physical_idc_3;
                    }else{
                        Alertwin.alert({message: "机房不能为空"});
                        return;
                    }
                    var logical_idc_3 = $("#logical_idc_3").val();
                    if(logical_idc_3){
                        edit['logical_idc'] = logical_idc_3;
                    }else{
                        Alertwin.alert({message: "区域不能为空"});
                        //return;
                    }
                    param['edit'] = JSON.stringify(edit);

                    layer.load();
                    param['csrfmiddlewaretoken'] = '{{ csrf_token }}';
                    $.ajax({
                        type: "POST",
                        url: '/cmdb/host/host1Edit/',
                        data:param,
                        error: function (request) {
                            layer.closeAll('loading');
                        },
                        success: function (data) {
                            location.reload();
                            layer.closeAll('loading');
                        }
                    });
                }
            }else{
                Alertwin.alert({message:"查询结果为空"});
            }
        }

        function toNotOnline(){
            var param = getHostIPOrSearch();
            if($("#tb tr").length > 1) {
                if ($.isEmptyObject(param)) {
                    Alertwin.alert({message: "请选择机器或条件查询"});
                    return;
                } else {
                    var toNotOnline = {}
                    $($("#to_not_online_form").serializeArray()).each(function(index,item){
                        if(item.value){
                            if(item.name == "biz_service" || item.name == "middleware" || item.name == "dns"){
                                if(toNotOnline[item.name]){
                                    toNotOnline[item.name].push(item.value);
                                }else{
                                    toNotOnline[item.name] = [item.value];
                                }
                            }else{
                                toNotOnline[item.name] = item.value;
                            }
                        }
                    })
                    param['toNotOnline'] = JSON.stringify(toNotOnline);

                    param['csrfmiddlewaretoken'] = '{{ csrf_token }}';
                    layer.load();
                    $.ajax({
                        type: "POST",
                        url: '/cmdb/host/host1ToNotOnline/',
                        data:param,
                        error: function (request) {
                            layer.closeAll('loading');
                        },
                        success: function (data) {
                            location.reload();
                            layer.closeAll('loading');
                        }
                    });
                }
            }else{
                Alertwin.alert({message:"查询结果为空"});
            }
        }

    </script>
{% endblock %}