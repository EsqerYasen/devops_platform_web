<div class="tab-pane" id="tab3">
	<pre v-html="save()"></pre>
	<evn-component
			typekey="production"
			:show_checkbox="False"
			:show_add="True"
			discribe="用于生产环境"
			title="生产">
	</evn-component>
	<evn-component
			typekey="disaster_recovery"
			:show_checkbox="True"
			:show_add="False"
			discribe="单站点或网络接入故障时可以选择灾备站点，保证业务连续性"
			title="灾备">
	</evn-component>
	<evn-component
			typekey="preview"
			:show_checkbox="True"
			:show_add="True"
			discribe="版本变更验证环境，确保每次变更稳定高效"
			title="灰度">
	</evn-component>
	<level level="S"> S级 : 主站节点全部高可用 有备份机房 </level>
	<level level="A"> A级 : 主站存在单节点 有备份机房 /  主站节点全部高可用 无备份机房 </level>
	<level level="B"> B级: 主站存在单节点 无备份机房 /  主站节点全部单节点 有备份机房 </level>
</div>
{% include "pro_assess_add/temps.html" %}
<script>
    var category_list = {{ category_list|safe }}
    var categoryItem_list = {{ categoryItem_list|safe }}


	var store = new Vuex.Store({
		modules:{
		    evns:{
		         state:{
			        production:{
			            data:[],
				        selected:true,
				        isDefectResut:''
			        },
				    disaster_recovery:{
			            data:[],
					    selected:false,
					    isDefectResut:''
				    },
				    preview:{
			            data:[],
					    selected:false,
					    isDefectResut:''
				    }
			    },
			    mutations:{
		             addData:function(state,key){
		                 var envType = '';

		                 switch (key){
			                 case 'production':
			                     envType=1;
			                     break;
			                 case 'disaster_recovery':
			                      envType=2;
			                     break;
			                 case 'preview':
			                      envType=3;
			                     break;
		                 }
		                 state[key].data.push({
			                'project_id':'',
					        'app_category':"1",
					        'app_category_item':"1",
					        'other_category_name':"",
					        'estimated_server_count':4,
					        'estimated_singleton_memory_capacity':8,
					        'estimated_singleton_CPU_core':4,
					        'estimated_singleton_disk_capacity':100,
					        'need_high_availability':false,
					        'comment':"",
					        'env':envType
		                 })
		             },
				    deleteData:function(state,keys){
		                 state[keys[0]].data.splice(keys[1],1)
				    },
                    copyData: function(state, key){
				        state[key].data = JSON.parse(JSON.stringify(state.production.data));
                    },
                    delData:function(state, key){
                        state[key].data = [];
                    }


			    },
			    actions:{
		             addData:function(context,key){
		                 context.commit('addData',key)
		             },
				    deleteData:function(context,keys){
		                 context.commit('deleteData',keys)
				    },
                    copyData:function(context, key){
				        context.commit('copyData',key)
                    }

			    }
		    }
		}
	});
	Vue.component('evn-component',{
	    template:"#evn-component",
		props:{
	        'typekey':{
	            type:String,
		        required:true
	        },
			'show_checkbox':{
	            type:Boolean,
				 default: false
			},
			'title':{
	            type:String,
				required:true,
			},
			'discribe':{
	            type:String
			}
		},
		methods:{
		    onAddData:function(key){
			    this.$store.dispatch('addData',key);
		    },
			onDeleteData:function(keys){
		        this.$store.dispatch('deleteData',keys);
			},
			getTotal:function(key,key1){
		        var total = 0;
		        var lists = this.$store.state.evns[key].data;
		        for(var i=0;i<lists.length;i++){
		            total+=  lists[i].need_high_availability? parseInt(lists[i][key1]*2) :parseInt(lists[i][key1]);//.estimated_singleton_CPU_core
		        }
		        return parseInt(total);
	        },

            resetData:function(typekey){
			    if(!this.show_checkbox){
			        this.$store.dispatch('delData',typekey);
                }else{
			        this.$store.dispatch('copyData',typekey);
                }
            },
            changeAppCategory:function(item){
			    var pid = item.app_category;
			    categoryItem_list.every(function(it){
			        if(it.parent_category_id == pid){
			            item.app_category_item = it.id;
			            return false;
                    }
                    return true;
                })
            }
		}

	});
	Vue.component('level',{
		template:"#level",
		props:{
		    'level':{
			    validator: function (value) {
			        return ['S', 'A', 'B'].indexOf(value) !== -1
			    }
		    }
		}

	});
	var vm = new Vue({
		el:'#tab3',
		store:store,
		data:{
		    title:"abc",
			True:true,
			False:false
		},
		methods:{
		  save:function(){
		      var f2edata = this.$store.state.evns;
		      var arr = [];
		      for(key in f2edata){
		          var obj = f2edata[key]['data'];
		          for(var i=0;i<obj.length;i++){
		              arr.push(obj[i]);
		          }
		      }
		      return arr;





		  }
		},
		mounted:function(){

		}
	});
	function initProAssess3(){
	}
	function tab3Save(){
	    var temparr = vm.save();
	}
</script>