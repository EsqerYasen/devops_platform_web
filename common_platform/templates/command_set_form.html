{% extends 'common/basic_layout.html' %}

{% block content %}
<script type="text/javascript" src="/static/hplus/js/works/vue.min.js"></script>
<script type="text/javascript" src="/static/hplus/js/works/vuex.js"></script>
<script type="text/javascript" src="/static/hplus/js/works/sortable.js"></script>
<script type="text/javascript" src="/static/hplus/js/works/vuedraggable.js"></script>
<script type="text/javascript" src="/static/hplus/js/works/alert.js"></script>
<script type="text/javascript" src="/static/hplus/js/works/works.js"></script>
<script type="text/javascript" src="/static/hplus/js/works/components/works.js"></script>
<link href="/static/hplus/css/works/works.css" rel="stylesheet">
<link href="/static/hplus/css/works/yum-font.css" rel="stylesheet">

<div class="wrapper wrapper-content fadeInRight" style="z-index: inherit">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>常用作业 {% if view_num == 0 %}新增{% elif view_num == 1 %}编辑{% else %}执行{% endif %}</h5>
                </div>
                <div class="ibox-content">
                    <div class="works_box clear" id="container">
                        <div class="layout_left clear">
                            <div class="titlebar clear">
                                <div class="l">
                                    <div class="warp">
                                        <input type="text" class="form-control bordero" style="margin-top: 5px;" v-model="$store.state.basic.name" value="作业管理平台-上线任务1">
                                    </div>
                                </div>
                                <div class="r">
                                    <div class="warp">
                                      <button class="btn btn-default">预览</button>

                                      <button class="btn btn-primary" @click="save">保存</button>

                                    </div>
                                </div>
                            </div>
                            <task-list></task-list>
                            <task-info></task-info>
                        </div>
                        <transation name="fade">
                            <yum-alert :message="$store.state.message" transiton="fade"></yum-alert>
                        </transation>
                        <task-cmds></task-cmds>
                    </div>
                    <template id="task-list">
                        <div class="left-task">
                            <div class="left-task-warp">
                                <ul>
                                   <draggable v-model="store.state.steps" :options="{animation:160}">
                                      <li v-for="(item,index) in store.state.steps"  class="clear tesklist_li" :class="{active:index==store.state.activeIndex}">
                                          <div class="clear" style="width: 85%;float: left" @click="changeActive(index)">
                                              <span class="num"> {% verbatim %}{{index+1}}{% endverbatim %} </span>
                                              <div class="cdis">
                                                  <span>
                                                      <input type="text" class="edit-input" v-model="item.name">
                                                  </span>
                                                  <span>
                                                    {% verbatim %}{{item.name}}{% endverbatim %}
                                                  </span>
                                              </div>
                                          </div>
                                        <i class="yum-font icon-guanbi del" style="font-size: 12px" @click="delTask(index)"></i>
                                      </li>
                                   </draggable>
                                </ul>
                                <div class="plus" @dblclick="addTask()">
                                    <i class="yum-font icon-plus-bold"></i>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template id="task-info">
                        <div class="task-content">
                            <div class="taskwap">
                                  <div class="top" >
                                    <div class="btn-group">
                                      <button :class="{'btn-danger':!($store.state.steps.length && $store.state.steps[$store.state.activeIndex].isGroup)}" class="btn " @click="changeSeqType(0)"> 串行 </button>
                                      <button :class="{'btn-danger':$store.state.steps.length && $store.state.steps[$store.state.activeIndex].isGroup}" class="btn"  @click="changeSeqType(1)"> 并行 </button>
                                    </div>
                                    <div class="tesklist clear">
                                      <draggable :list="curCmds"  :options="{group:'task',animation:160,sort:true,scroll:true}" class="dragga clear" @add="updateLines">

                                        <div class="tesk"   v-for="(it, index) in curCmds" :class="{'active':$store.state.steps[$store.state.activeIndex]&&$store.state.steps[$store.state.activeIndex].activeIndex==index}" @click="selectTool(index)">
                                          <div class="tabs" v-if="it.list&&it.list.length>1">
                                            <span class="btns"
                                                  :class={'current':i==it['activeIndex']}
                                                  v-for="(item,i) in it.list">
                                              <div class="con" @click="tabClick({ind1:index,ind2:i})">{% verbatim %}{{index+1}}-{{i+1}}{% endverbatim %}</div>
                                              <i class="yum-font icon-guanbi tabClose" @click="deleteTask({ind1:index,ind2:i})"></i>
                                            </span>
                                          </div>
                                          <div class="tabscon">
                                            <div class="intags"  v-for="(item,i) in it.list" :class={'show':i==(it['activeIndex']||0)}>
                                              <i class="yum-font icon-edit edit" @click="showEdit(index)" ></i>
                                              <div class="teskwap" :title="item.value">
                                                <p class="center">{% verbatim %}{{ item.value || item.name }}{% endverbatim %}</p>
                                              </div>
                                              <div class="teskbottom" :title="item.name" >
                                                <p>{% verbatim %}{{ item.name }}{% endverbatim %}</p>
                                              </div>
                                              <i class="yum-font teskico icon-guanbi" @click="deleteTaskAll(index)"></i>
                                              <div v-if="it.list&&it.list.length==1" class="number">{% verbatim %}{{ index+1 }}{% endverbatim %}</div>
                                            </div>
                                          </div>
                                        </div>
                                      </draggable>

                                    </div>


                                          <div class="modal fade" style="text-align: left; z-index: 99;" id="dialogModal">
                                              <div class="modal-dialog">
                                                  <div class="modal-content">
                                                      <div class="modal-header">
                                                        <span type="button" class="close close_hide" @click="closeEdit">
                                                           <i class="yum-font icon-guanbi"></i>
                                                        </span>
                                                        <h4 class="modal-title" id="myModalLabel">编辑-{% verbatim %}{{curCmd.name}}{% endverbatim %}</h4>
                                                      </div>
                                                      <div class="modal-body">
                                                          <form class="form-horizontal">
                                                              <div class="form-group" v-for="(ites, i$1) in curCmd.param">
                                                                <label class="col-sm-2 control-label">{% verbatim %}{{ites.paramNameZh}}{% endverbatim %}</label>

                                                                <div class="col-sm-10">
                                                                  <div v-if="ites.type==='textshell'">
                                                                    <textarea style="height: 150px" class="form-control" v-model="ites.value"  placeholder="请输入shell脚本"></textarea>
                                                                  </div>
                                                                  <div v-if="ites.type==='text'">
                                                                    <input type="text" class="form-control" v-model="ites.value" placeholder="请输入shell脚本">
                                                                  </div>
                                                                </div>
                                                              </div>
                                                          </form>
                                                      </div>
                                                      <div class="modal-footer">
                                                        <button type="button" class="btn btn-primary" @click="closeEdit">保存</button>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>

                                </div>
{#                                <div style="position: fixed; bottom: 1px; left: 0px; width: 100%; max-height: 300px; overflow:auto">#}
{#                                    <button class="btn btn-danger shu"> 数据 </button>#}
{#                                    <pre style="text-align: left; display: none">{% verbatim %}{{$store.state.steps}}{% endverbatim %}</pre>#}
{#                                </div>#}
                            </div>
                        </div>
                    </template>
                    <template id="task-cmds">
                        <div class="right-tast clear">
                            <div class="title">工具箱</div>
                            <div class="rt-top">
                              <ul>
                                <li v-for="(item, index) in top" @click="changeCmdTopIndex(item, index)" :class="{act:cmdIndexTop==index}">{% verbatim %}{{ item }}{% endverbatim %}</li>
                              </ul>
                            </div>
                            <div class="rt-left">
                              <ul>
                                <li v-for="(item, index) in left" @click="changeCmdLeftIndex(item, index)" :class="{act:cmdIndexLeft==index}">{% verbatim %}{{ item }}{% endverbatim %}</li>
                              </ul>
                            </div>
                            <div class="rt-right">
                              <ul>
                                <draggable  :list="cmds"  :options="{group:{name:'task', pull:'clone', put:false },animation:160,filter:'.dragga',scroll:true}">
                                  <li v-for="(cmd, i) in cmds" class="cmds">{% verbatim %}{{ cmd.name }}{% endverbatim %}</li>
                                </draggable>
                              </ul>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(function(){

        $(".works_box").on('dblclick','.tesklist_li',function () {
          var $sdis = $(this).find('.cdis');
          if(!$sdis.hasClass('edit')){
            $sdis.addClass('edit');
            $sdis.find('input').focus();
          }else{
            $sdis.removeClass('edit');
          }
        });

        $(".works_box").on('blur','.tesklist_li input',function () {
          var $p = $(this).parents('.cdis');
          $p.removeClass('edit');
        });
        $(".shu").on("click",function(){
          var ps = $(this).parent().find('pre');
          if(ps.is(":hidden")){
            ps.show()
          }else{
            ps.hide()
          }
        })
    });
      new Vue( {el: '#container',
        store:store,
        data:{
        },
        methods:{
          save: function(){
            var res = transLocalToApiData(this.$store.state.basic, this.$store.state.steps);
          }
        }
      });
      //transApiDataToLocal({"name":"ttteeeeeeeeeeeeeee","steps":[{"lines":[{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn ":"content ","paramNameZh ":"源代码 ","type ":"textshell ","desc ":"自定义shell文件内容 ","no ":"0 ","valueSet ":[],"default ":""},{"paramNameEn ":"param ","paramNameZh ":"参数列表 ","type ":"text ","desc ":"把所有参数全列出来","no ":"1 ","valueSet ":[],"default ":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":1},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content ","paramNameZh":"源代码 ","type":"textshell","desc":"自定义shell文件内容 ","no":"0 ","valueSet":[],"default":""},{"paramNameEn":"param ","paramNameZh":"参数列表 ","type":"text","desc":"把所有参数全列出来","no":"1 ","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":2},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content ","paramNameZh":"源代码 ","type":"textshell","desc":"自定义shell文件内容 ","no":"0 ","valueSet":[],"default":""},{"paramNameEn":"param ","paramNameZh":"参数列表 ","type":"text","desc":"把所有参数全列出来","no":"1 ","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":3},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content ","paramNameZh":"源代码 ","type":"textshell","desc":"自定义shell文件内容 ","no":"0 ","valueSet":[],"default":""},{"paramNameEn":"param ","paramNameZh":"参数列表 ","type":"text","desc":"把所有参数全列出来","no":"1 ","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":4},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content ","paramNameZh":"源代码 ","type":"textshell","desc":"自定义shell文件内容 ","no":"0 ","valueSet":[],"default":""},{"paramNameEn":"param ","paramNameZh":"参数列表 ","type":"text","desc":"把所有参数全列出来","no":"1 ","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":5}],"name":"fffff","activeIndex":0,"seq_no":1}]});
    transApiDataToLocal({"name":"ttteeeeeeeeeeeeeee","steps":[{"lines":[{"id":1,"name":"SHELL脚本111111","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content","paramNameZh":"源代码","type":"textshell","desc":"自定义shell文件内容","no":"0","valueSet":[],"default":""},{"paramNameEn":"param","paramNameZh":"参数列表","type":"text","desc":"把所有参数全列出来","no":"1","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":1},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content","paramNameZh":"源代码","type":"textshell","desc":"自定义shell文件内容","no":"0","valueSet":[],"default":""},{"paramNameEn":"param","paramNameZh":"参数列表","type":"text","desc":"把所有参数全列出来","no":"1","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":2},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content","paramNameZh":"源代码","type":"textshell","desc":"自定义shell文件内容","no":"0","valueSet":[],"default":""},{"paramNameEn":"param","paramNameZh":"参数列表","type":"text","desc":"把所有参数全列出来","no":"1","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":3},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content","paramNameZh":"源代码","type":"textshell","desc":"自定义shell文件内容","no":"0","valueSet":[],"default":""},{"paramNameEn":"param","paramNameZh":"参数列表","type":"text","desc":"把所有参数全列出来","no":"1","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":4},{"id":1,"name":"SHELL脚本","tool_set_prime_type":1,"tool_set_type":1,"command":"cp","param":[{"paramNameEn":"content","paramNameZh":"源代码","type":"textshell","desc":"自定义shell文件内容","no":"0","valueSet":[],"default":""},{"paramNameEn":"param","paramNameZh":"参数列表","type":"text","desc":"把所有参数全列出来","no":"1","valueSet":[],"default":""}],"is_enabled":true,"created_by":"admin","updated_by":"admin","tool_set_type_zh":"指令","tool_set_prime_type_zh":"原子","sub_seq_no":5}],"name":"fffff","activeIndex":0,"seq_no":1}]});
</script>

{% endblock %}